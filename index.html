<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT, IP & CCI Training Declaration Form</title>
    <style>
        @page {
            size: A4;
            margin: 20mm;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            line-height: 1.4;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #000;
        }
        
        .form-container {
            max-width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-title {
            font-weight: bold;
            font-size: 14pt;
            margin-bottom: 20px;
            text-decoration: underline;
        }
        
        .training-info {
            margin-bottom: 25px;
        }
        
        .info-row {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .info-label {
            font-weight: bold;
            min-width: 140px;
        }
        
        .info-input {
            border: none;
            border-bottom: 1px solid #000;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            padding: 2px 5px;
            flex: 1;
            background: transparent;
            cursor: pointer;
        }
        
        .section-title {
            font-weight: bold;
            margin: 25px 0 15px 0;
            text-decoration: underline;
        }
        
        .declaration-text {
            text-align: justify;
            margin-bottom: 15px;
        }
        
        .policy-list {
            margin: 15px 0;
            padding-left: 0;
            counter-reset: policy-counter;
        }
        
        .policy-item {
            margin: 12px 0;
            padding-left: 25px;
            text-align: justify;
            position: relative;
        }
        
        .policy-item::before {
            content: counter(policy-counter);
            counter-increment: policy-counter;
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .sub-list {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .sub-item {
            margin: 8px 0;
            text-align: justify;
            position: relative;
            padding-left: 15px;
        }
        
        .sub-item::before {
            content: "- ";
            position: absolute;
            left: 0;
        }
        
        .participant-details {
            margin-top: 40px;
        }
        
        .details-title {
            font-weight: bold;
            margin-bottom: 20px;
            text-decoration: underline;
        }
        
        .detail-row {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .detail-label {
            font-weight: bold;
            min-width: 160px;
        }
        
        .detail-input {
            border: none;
            border-bottom: 1px solid #000;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            padding: 2px 5px;
            flex: 1;
            background: transparent;
        }
        
        .detail-input[type="date"] {
            cursor: pointer;
        }
        
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .signature-item {
            flex: 1;
        }
        
        .signature-item:first-child {
            margin-right: 40px;
        }
        
        .signature-canvas {
            flex: 1;
            max-width: 250px;
            height: 60px;
            border: 1px solid #000;
            background: white;
            cursor: crosshair;
        }
        
        .note {
            font-style: italic;
            margin-top: 30px;
            font-size: 11pt;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .submit-btn:hover {
            background-color: #45a049;
        }
        
        .clear-btn {
            padding: 5px 10px;
            font-size: 11px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .success-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .form-container {
                box-shadow: none;
                max-width: none;
            }
            
            .button-container, .success-message, .clear-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <div class="form-title">
                Mirafra Technologies - IT, IP & CCI POLICY TRAINING -- PARTICIPANT DECLARATION FORM
            </div>
        </div>
        
        <form id="declarationForm">
            <div class="training-info">
                <div class="info-row">
                    <span class="info-label">Date of Training:</span>
                    <input type="date" class="info-input" name="trainingDate" required>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Trainer Name:</span>
                    <input type="text" class="info-input" name="trainerName" required>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Location / Mode:</span>
                    <input type="text" class="info-input" name="locationMode" required>
                </div>
            </div>
            
            <div class="section-title">Participant Declaration</div>
            
            <div class="declaration-text">
                I, the undersigned, hereby declare that I have attended the <strong>IT, Intellectual Property (IP), and Client Confidential Information (CCI) Policy Training</strong> conducted on the date mentioned above.
            </div>
            
            <div class="declaration-text">
                By signing this document, I confirm that:
            </div>
            
            <div class="policy-list">
                <div class="policy-item">
                    I have actively participated in the training session.
                </div>
                
                <div class="policy-item">
                    I have understood the key policies related to:
                    <div class="sub-list">
                        <div class="sub-item">Protection and responsible use of company IT systems and assets.</div>
                        <div class="sub-item">Confidentiality of client data and internal company information.</div>
                        <div class="sub-item">Proper handling and non-disclosure of Intellectual Property (IP) owned by the organisation or its clients.</div>
                        <div class="sub-item">Legal and ethical implications of data misuse or policy violations.</div>
                    </div>
                </div>
                
                <div class="policy-item">
                    I am aware of the Do's and Don'ts regarding:
                    <div class="sub-list">
                        <div class="sub-item">Use of personal devices and external drives on client systems.</div>
                        <div class="sub-item">Sharing sensitive information through emails, chats, or social media.</div>
                        <div class="sub-item">Retaining or transferring client/company data after project completion.</div>
                    </div>
                </div>
                
                <div class="policy-item">
                    I understand that any breach of these policies can lead to disciplinary or legal action.
                </div>
                
                <div class="policy-item">
                    I commit to adhering strictly to the IT, IP & CCI policies in my professional conduct.
                </div>
            </div>
            
            <div class="participant-details">
                <div class="details-title">Participant Details</div>
                
                <div class="detail-row">
                    <span class="detail-label">Full Name:</span>
                    <input type="text" class="detail-input" name="fullName" required>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Mirafra Employee ID:</span>
                    <input type="text" class="detail-input" name="employeeId" required>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Client Name:</span>
                    <input type="text" class="detail-input" name="clientName" required>
                </div>
                
                <div class="signature-section">
                    <div class="signature-item">
                        <div class="detail-row">
                            <span class="detail-label">Signature:</span>
                            <canvas class="signature-canvas" id="signatureCanvas" width="300" height="80"></canvas>
                        </div>
                        <button type="button" class="clear-btn" onclick="clearSignature()">Clear Signature</button>
                    </div>
                    
                    <div class="signature-item">
                        <div class="detail-row">
                            <span class="detail-label">Date:</span>
                            <input type="date" class="detail-input" name="signatureDate" required>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="note">
                <em>Note: This declaration will be maintained for compliance and audit purposes.</em>
            </div>
        </form>
        
        <div class="button-container">
            <button type="button" class="submit-btn" onclick="submitForm()">Submit Form</button>
        </div>
        
        <div id="successMessage" class="success-message">
            Form submitted successfully! Data has been saved on the server.
        </div>
    </div>

    <script>
        let isDrawing = false;
        let signatureCanvas, ctx;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default for signature date
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="signatureDate"]').value = today;
            
            // Initialize signature canvas
            signatureCanvas = document.getElementById('signatureCanvas');
            ctx = signatureCanvas.getContext('2d');
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            // Mouse events for signature
            signatureCanvas.addEventListener('mousedown', startDrawing);
            signatureCanvas.addEventListener('mousemove', draw);
            signatureCanvas.addEventListener('mouseup', stopDrawing);
            signatureCanvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            signatureCanvas.addEventListener('touchstart', handleTouch);
            signatureCanvas.addEventListener('touchmove', handleTouch);
            signatureCanvas.addEventListener('touchend', stopDrawing);
        });

        function startDrawing(e) {
            isDrawing = true;
            e.preventDefault();
            const rect = signatureCanvas.getBoundingClientRect();
            const x = getEventX(e) - rect.left;
            const y = getEventY(e) - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const rect = signatureCanvas.getBoundingClientRect();
            const x = getEventX(e) - rect.left;
            const y = getEventY(e) - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing(e) {
            if (e) e.preventDefault();
            isDrawing = false;
        }

        function getEventX(e) {
            if (e.touches && e.touches.length > 0) {
                return e.touches[0].clientX;
            }
            return e.clientX || 0;
        }

        function getEventY(e) {
            if (e.touches && e.touches.length > 0) {
                return e.touches[0].clientY;
            }
            return e.clientY || 0;
        }

        function handleTouch(e) {
            e.preventDefault();
            
            // Map touch events to mouse events
            let mouseEvent;
            switch(e.type) {
                case 'touchstart':
                    mouseEvent = new MouseEvent('mousedown', {
                        clientX: e.touches[0].clientX,
                        clientY: e.touches[0].clientY
                    });
                    break;
                case 'touchmove':
                    mouseEvent = new MouseEvent('mousemove', {
                        clientX: e.touches[0].clientX,
                        clientY: e.touches[0].clientY
                    });
                    break;
                case 'touchend':
                    mouseEvent = new MouseEvent('mouseup', {});
                    break;
                default:
                    return;
            }
            
            // Dispatch the mapped mouse event
            if (e.type === 'touchstart') {
                startDrawing(e);
            } else if (e.type === 'touchmove') {
                draw(e);
            } else if (e.type === 'touchend') {
                stopDrawing(e);
            }
        }

        function clearSignature() {
            ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        }

        function isSignatureEmpty() {
            const imageData = ctx.getImageData(0, 0, signatureCanvas.width, signatureCanvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                if (data[i + 3] !== 0) return false; // Check alpha channel
            }
            return true;
        }

        async function submitForm() {
            const form = document.getElementById('declarationForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Check if signature is provided
            if (isSignatureEmpty()) {
                alert('Please provide your signature.');
                return;
            }
            
            // Convert FormData to JSON
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            // Add signature as base64
            data.signature = signatureCanvas.toDataURL();
            
            try {
                const response = await fetch('/submit-form', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    document.getElementById('successMessage').style.display = 'block';
                    // Disable form after successful submission
                    const inputs = form.querySelectorAll('input');
                    inputs.forEach(input => input.readOnly = true);
                    signatureCanvas.style.pointerEvents = 'none';
                    document.querySelector('.submit-btn').style.display = 'none';
                    document.querySelector('.clear-btn').style.display = 'none';
                } else {
                    alert('Error submitting form. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error submitting form. Please try again.');
            }
        }
    </script>
</body>
</html>